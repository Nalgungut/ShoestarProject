<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shoestar.admin.event.dao.AdminRange_DiscountDAO">

	<!-- 조회 쿼리 -->
	<select id="AdminRDiscountList" resultType="rds">
				SELECT
				    rd_no ,
				    rd_title ,
					rd_content ,
					rd_discount ,
					rd_date ,
					rd_edate
				FROM
				    range_discount
				ORDER BY rd_date ASC
	</select>
	
	<!-- 상세 조회 -->
	<select id="AdminRDiscountDetail" parameterType="rds" resultType="rds">
				SELECT 
					rd_no, 
					rd_title, 
					rd_content, 
					rd_discount,
					rd_date, 
					rd_edate
				FROM 
					range_discount 
				WHERE 
					rd_no = #{rd_no}
	</select>
	
	<!-- 참조 조회 -->
	<select id="AdminDetail" parameterType="rds" resultType="rds">
	<!-- 		select distinct
			    p.pd_no, p.pd_name, rt.pct_no, rp.rd_no, pt.pct_name, p.pim_main
			from
			    prod p
            inner join
                prod_ctg pt
            on
                p.pct_no = pt.pct_no
			inner join
			    rd_type rt
			on
			    p.pct_no = rt.pct_no
			inner join
			    rd_product rp 
			on
			    p.pd_no = rp.pd_no
            where rt.rd_no = #{rd_no}
			order by p.pd_no asc -->
		select distinct
               p.pd_no,
                p.pct_no,
                p.pd_name,
                p.pim_main,
                pt.pct_name,
                rp.rd_no
			from
			    prod p
            inner join
                prod_ctg pt
            on
                p.pct_no = pt.pct_no
			left outer join
			    rd_product rp 
			on
			    p.pd_no = rp.pd_no
            inner join
                range_discount rd
            on 
               rd.rd_no = rp.rd_no
            where rd.rd_no = #{rd_no}
			order by p.pd_no asc
	</select>
	
	<select id="rdNo" resultType="int">
		select rdis_seq.nextval from dual
	</select>
	
		<!-- 범위 입력 작업 -->
	<insert id="AdminRDisInsert" parameterType="rds">
		<!-- <selectKey keyProperty="rd_no" resultType="int" order="BEFORE">
			select rdis_seq.nextval from dual		
		</selectKey>
	 -->
		INSERT INTO range_discount (
					rd_no ,
				    rd_title ,
					rd_content ,
					rd_discount ,
					rd_date
		    <if test= "rd_edate != null">
				, rd_edate 
			</if>
		    )
		VALUES (#{rd_no}, #{rd_title}, #{rd_content}, #{rd_discount}, sysdate
		 	<if test= "rd_edate != null">
				, #{rd_edate}
			</if>
		    )
	</insert>
		
</mapper>

